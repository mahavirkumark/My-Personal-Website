<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Book</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc; /* Tailwind gray-50 */
            /* Crucial: Add padding to the top to prevent content hiding behind the fixed navbar */
            padding-top: 6rem; 
        }
        /* Mobile/Tablet Landscape Adjustment: Force the two columns to stack on screens smaller than 768px (like phones in landscape) */
        @media (max-width: 767px) {
            .md\:grid-cols-2 {
                grid-template-columns: 1fr; /* Stack columns on small screens */
            }
        }
        /* FIX: Ensure scrollbar is visible */
        /* The custom CSS that hid the scrollbar has been removed, relying on browser defaults. */
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">

    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="container mx-auto flex justify-between items-center p-4 md:px-8">
            <div class="flex items-center gap-2 text-lg md:text-xl font-bold text-gray-800">
                <i class="fas fa-user-circle text-indigo-500 text-2xl md:text-3xl"></i>
                <span class="text-lg md:text-xl">My Personal Website</span>
            </div>

            <div class="hidden md:flex space-x-6 text-gray-700 font-medium">
                <a href="home.html" class="flex items-center gap-2 hover:text-indigo-600 transition duration-300 hover:-translate-y-0.5 text-lg"><i class="fas fa-house"></i> Home</a>
                <a href="address.html" class="flex items-center gap-2 hover:text-indigo-600 transition duration-300 hover:-translate-y-0.5 text-lg"><i class="fas fa-tasks"></i> Address</a>
                <a href="password.html" class="flex items-center gap-2 hover:text-indigo-600 transition duration-300 hover:-translate-y-0.5 text-lg"><i class="fas fa-key"></i> Passwords</a>
                <a href="income.html" class="flex items-center gap-2 hover:text-indigo-600 transition duration-300 hover:-translate-y-0.5 text-lg"><i class="fas fa-wallet"></i> Income</a>
                <a href="links.html" class="flex items-center gap-2 hover:text-indigo-600 transition duration-300 hover:-translate-y-0.5 text-lg"><i class="fas fa-link"></i> Links</a>
                <a href="calendar.html" class="flex items-center gap-2 hover:text-indigo-600 transition duration-300 hover:-translate-y-0.5 text-lg"><i class="fas fa-calendar-alt"></i> Calendar</a>
            </div>

            <div class="hidden md:flex items-center gap-4">
                <div class="text-right">
                    <p id="userName" class="font-bold text-gray-900">Loading...</p>
                    <p id="userEmail" class="text-sm text-gray-500">Loading...</p>
                    <p id="userId" class="hidden"></p>
                </div>
                <img id="userPhoto" src="https://via.placeholder.com/40" class="w-10 h-10 rounded-full border-2 border-indigo-500">
                <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-full hover:bg-red-600 transition duration-300 text-sm">Logout</button>
            </div>
            
            <button id="menu-btn" class="md:hidden text-gray-700 text-2xl"><i class="fas fa-bars"></i></button>
        </div>
        
        <div id="mobileMenu" class="hidden md:hidden flex flex-col px-4 pb-4 space-y-2 text-sm text-gray-700 font-medium bg-gray-50">
            <a href="home.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-200"><i class="fas fa-house"></i> Home</a>
            <a href="address.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-200"><i class="fas fa-tasks"></i> Address</a>
            <a href="password.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-200"><i class="fas fa-key"></i> Passwords</a>
            <a href="income.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-200"><i class="fas fa-wallet"></i> Income</a>
            <a href="links.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-200"><i class="fas fa-link"></i> Links</a>
            <a href="calendar.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-200"><i class="fas fa-calendar-alt"></i> Calendar</a>
            <div class="border-t border-gray-300 mt-2 pt-2">
                <p id="mobileUserName" class="font-bold text-gray-900">Loading...</p>
                <p id="mobileUserEmail" class="text-xs text-gray-500">Loading...</p>
                <button onclick="logout()" class="bg-red-500 text-white px-3 py-2 rounded-full hover:bg-red-600 mt-2 w-full">Logout</button>
            </div>
        </div>
    </nav>
    
    <div class="max-w-7xl mx-auto p-4 md:p-8 grid md:grid-cols-2 gap-8">
        
        <div class="bg-white p-6 rounded-xl shadow-lg h-fit md:sticky md:top-24">
            <h2 class="text-2xl font-bold mb-6 text-indigo-700 border-b pb-2">‚ûï Save New Address</h2>
            <div class="space-y-4">
                <label for="placeInput" class="block text-sm font-medium text-gray-700">Place Name (e.g., Home, Office)</label>
                <input type="text" id="placeInput" placeholder="Enter place name..." 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" />

                <label for="landmarkInput" class="block text-sm font-medium text-gray-700">Landmark / Details</label>
                <input type="text" id="landmarkInput" placeholder="Enter landmark or full address details..." 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" />
                
                <button id="saveAddressBtn" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition duration-300 flex items-center justify-center">
                    <i class="fas fa-save mr-2"></i> Save Address
                </button>
            </div>
        </div>

        <div>
            <h2 class="text-2xl font-bold mb-4 text-indigo-700">üè† Your Saved Addresses</h2>
            
            <input type="text" id="searchInput" placeholder="Search place or landmark..." 
                   class="w-full p-3 mb-6 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition shadow-sm"
                   oninput="filterAddresses()" />

            <div id="addressList" class="space-y-4 h-[400px] overflow-y-auto">
                </div>
        </div>
    </div>

    <footer class="mt-12 pt-3 pb-3 bg-white text-gray-600 text-center text-sm border-t">
        &copy; 2025 Personal Website | All rights reserved
    </footer>

    <script>
        // --- FIREBASE CONFIGURATION (Keep as is) ---
        var firebaseConfig = {
            apiKey: "AIzaSyB78RTVCg0cmSPp7A1RJyyAgBuCeolO0cc",
            authDomain: "sk12-58e9e.firebaseapp.com",
            databaseURL: "https://sk12-58e9e-default-rtdb.firebaseio.com",
            projectId: "sk12-58e9e",
            storageBucket: "sk12-58e9e.appspot.com",
            messagingSenderId: "470207874652",
            appId: "1:470207874652:web:67ba1cf3629b7e5b144899"
        };
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        // --- GLOBAL VARIABLES & UI ELEMENTS ---
        let allAddresses = []; 
        const addressListEl = document.getElementById("addressList");
        const menuBtn = document.getElementById("menu-btn");
        const mobileMenu = document.getElementById("mobileMenu");

        // --- UI EVENT LISTENERS ---
        document.getElementById("saveAddressBtn").addEventListener("click", saveAddress);
        
        // Mobile menu toggle logic
        menuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- AUTHENTICATION STATE & UI UPDATE ---
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // Update Desktop UI
                document.getElementById("userName").innerText = user.displayName || "My Account";
                document.getElementById("userEmail").innerText = user.email;
                document.getElementById("userPhoto").src = user.photoURL || "https://via.placeholder.com/40";
                // Update Mobile UI
                document.getElementById("mobileUserName").innerText = user.displayName || "My Account";
                document.getElementById("mobileUserEmail").innerText = user.email;
                
                loadAddresses(user.uid);
            } else {
                window.location.href = "index.html";
            }
        });
        
        function logout() {
            firebase.auth().signOut().then(() => window.location.href = "index.html");
        }

        // --- CRUD FUNCTIONS ---

        function saveAddress() {
            const user = firebase.auth().currentUser;
            if (!user || !user.uid) {
                console.error("User not logged in or UID missing. Cannot save data.");
                alert("Error: Please log in again to save data.");
                return;
            }
            
            const place = document.getElementById("placeInput").value.trim();
            const landmark = document.getElementById("landmarkInput").value.trim();
            
            if (!place || !landmark) {
                alert("Please fill both Place Name and Landmark/Details.");
                return;
            }

            const newRef = firebase.database().ref("addresses/" + user.uid).push();
            newRef.set({
                id: newRef.key,
                place: place,
                landmark: landmark,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                document.getElementById("placeInput").value = "";
                document.getElementById("landmarkInput").value = "";
            }).catch(error => {
                console.error("Error saving address: ", error);
                alert("Failed to save address. Check console for details. (Ensure Firebase Rules are correct!)");
            });
        }

        function loadAddresses(uid) {
            firebase.database().ref("addresses/" + uid).on("value", (snapshot) => {
                allAddresses = [];
                snapshot.forEach((child) => {
                    allAddresses.push(child.val());
                });
                filterAddresses(); 
            });
        }
        
        function editAddress(uid, id, oldPlace, oldLandmark) {
            const newPlace = prompt("EDIT PLACE NAME:", oldPlace);
            if (newPlace === null) return;
            const newLandmark = prompt("EDIT LANDMARK / DETAILS:", oldLandmark);
            if (newLandmark === null) return;

            const finalPlace = newPlace.trim() || oldPlace;
            const finalLandmark = newLandmark.trim() || oldLandmark;

            if (finalPlace && finalLandmark) {
                firebase.database().ref("addresses/" + uid + "/" + id).update({
                    place: finalPlace,
                    landmark: finalLandmark
                }).catch(error => console.error("Update failed:", error));
            } else {
                alert("Place Name and Landmark cannot be empty.");
            }
        }

        function deleteAddress(uid, id) {
            if (confirm("Are you sure you want to permanently delete this address?")) {
                firebase.database().ref("addresses/" + uid + "/" + id).remove()
                    .catch(error => console.error("Deletion failed:", error));
            }
        }

        function shareAddress(place, landmark) {
            const text = `Check out this address:\nPlace: ${place}\nDetails: ${landmark}`;
            
            if (navigator.share) {
                navigator.share({
                    title: `Address: ${place}`,
                    text: text,
                }).catch(error => console.error('Error sharing', error));
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Address copied to clipboard! üìã');
                }).catch(err => {
                    alert('Could not copy address. Check console for error.');
                    console.error('Could not copy text: ', err);
                });
            }
        }
        

        // --- FILTERING & RENDERING ---
        
        function displayFilteredAddresses(dataList) {
            addressListEl.innerHTML = "";
            
            if (dataList.length === 0) {
                addressListEl.innerHTML = '<div class="text-center p-6 text-gray-500 bg-gray-100 rounded-lg">No addresses found matching your search.</div>';
                return;
            }

            dataList.forEach((data) => {
                const uid = firebase.auth().currentUser.uid;
                const div = document.createElement("div");
                div.className = "address-item bg-white p-4 border border-gray-200 rounded-xl shadow-md hover:shadow-lg transition duration-300";
                
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-grow">
                            <p class="text-lg font-bold text-gray-800">${data.place}</p>
                            <p class="text-sm text-gray-600">${data.landmark}</p>
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap justify-end gap-2 mt-3"> 
                        <button class="bg-blue-500 text-white px-3 py-1 rounded-full hover:bg-blue-600 transition text-sm flex items-center" 
                                onclick="shareAddress('${data.place}', '${data.landmark}')">
                            <i class="fas fa-share-alt mr-1"></i> Share
                        </button>
                        <button class="bg-yellow-500 text-white px-3 py-1 rounded-full hover:bg-yellow-600 transition text-sm flex items-center" 
                                onclick="editAddress('${uid}', '${data.id}', '${data.place}', '${data.landmark}')">
                            <i class="fas fa-edit mr-1"></i> Edit
                        </button>
                        <button class="bg-red-500 text-white px-3 py-1 rounded-full hover:bg-red-600 transition text-sm flex items-center" 
                                onclick="deleteAddress('${uid}', '${data.id}')">
                            <i class="fas fa-trash-alt mr-1"></i> Delete
                        </button>
                    </div>
                `;
                addressListEl.appendChild(div);
            });
        }

        function filterAddresses() {
            const query = document.getElementById("searchInput").value.toLowerCase();
            const filtered = allAddresses.filter(item =>
                item.place.toLowerCase().includes(query) || item.landmark.toLowerCase().includes(query)
            );
            displayFilteredAddresses(filtered);
        }

    </script>
</body>
</html>

