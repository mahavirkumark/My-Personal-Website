<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Task Calendar</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<!-- jsPDF & autoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; background-color: #f3f4f6; margin:0; }
  nav a { text-decoration:none; color:black; font-size:17px; padding:5px; }
  nav a:hover { text-decoration:none; font-size:17px; padding:5px; }
  .calendar-cell { min-height: 80px; padding:0.5rem; border-radius:0.5rem; border:1px solid #d1d5db; background:#fff; cursor:pointer; }
  .calendar-cell:hover { background:#e5e7eb; }
  .today { border: 2px solid #3b82f6; }
  .sunday { background-color:#f97316; color:#fff; }
  .sunday:hover { background-color:#2563eb; }
  #existingTasks { overflow-y:auto; }
  #existingTasks::-webkit-scrollbar { width:8px; }
  #existingTasks::-webkit-scrollbar-thumb { background:#bbb; border-radius:4px; }
  #existingTasks::-webkit-scrollbar-thumb:hover { background:#888; }

  body { font-family: Arial, sans-serif; background-color: #f3f4f6; margin:0; }
  nav a { text-decoration:none; color:black; font-size:17px; padding:5px; }
  nav a:hover { text-decoration:none; font-size:17px; padding:5px; }
  .calendar-cell { min-height: 80px;min-width: 100px; padding:0.5rem; border-radius:0.5rem; border:1px solid #d1d5db; background:#fff; cursor:pointer; }
  .calendar-cell:hover { background:#e5e7eb; }
  .today { border: 2px solid #3b82f6; }
  .sunday { background-color:#f97316; color:#fff; }
  .sunday:hover { background-color:#2563eb; }
  #existingTasks { overflow-y:auto; }
  #existingTasks::-webkit-scrollbar { width:8px; }
  #existingTasks::-webkit-scrollbar-thumb { background:#bbb; border-radius:4px; }
  #existingTasks::-webkit-scrollbar-thumb:hover { background:#888; }

  /* Responsive Calendar Grid */
  #calendar { display:grid; gap:5px; }

  /* Mobile: max 2 cells per row, smaller task container */
  @media (max-width: 639px) {
    #calendar { grid-template-columns: repeat(2, 1fr); }
    #existingTasks { max-height:200px; }
  }

  /* Tablet: 4 cells per row */
  @media (min-width: 640px) and (max-width:1023px) {
    #calendar { grid-template-columns: repeat(4, 1fr); gap:6px; }
    #existingTasks { max-height:300px; }
  }

  /* Laptop & Desktop: 7 cells per row, wider width */
  @media (min-width: 1524px) {
    #calendar { grid-template-columns: repeat(7, 1fr); gap:10px; max-width:1600px; margin:auto; }
    #existingTasks { max-height:400px; }
  }
#existingTasks {
  max-height: 400px; /* increased from 30rem */
  overflow-y: auto;
  font-size: 25px; /* already present */
}

nav a {
  text-decoration: none;
  color: black;
  font-size: 17px;

  

}



</style>



  <style>
    /* Reusable Animations */
    .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInUp 0.8s forwards; }
    .slide-left { opacity: 0; transform: translateX(-20px); animation: slideLeft 0.8s forwards; }
    .slide-right { opacity: 0; transform: translateX(20px); animation: slideRight 0.8s forwards; }

    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    @keyframes slideLeft { to { opacity: 1; transform: translateX(0); } }
    @keyframes slideRight { to { opacity: 1; transform: translateX(0); } }

    nav a { transition: transform 0.3s, color 0.3s; }
    nav a:hover { transform: translateY(-2px); color: #3b82f6; } /* Tailwind blue-500 */
  </style>
</head>
<body class="bg-gray-50">

<!-- NAVBAR -->
<nav class="bg-white shadow-md fixed w-full z-50">
  <div class="container mx-auto flex justify-between items-center p-4 md:px-8">
    <div class="flex items-center gap-2 text-xl font-bold text-black">
      <i class="fas fa-user"></i> My Personal Website
    </div>

    <!-- Desktop Links -->
    <div class="hidden md:flex space-x-6">
      <a href="home.html" class="flex items-center gap-2"><i class="fas fa-house"></i> Home</a>
      <a href="adress.html" class="flex items-center gap-2"><i class="fas fa-tasks"></i> Address</a>
      <a href="income.html" class="flex items-center gap-2"><i class="fas fa-wallet"></i> Income</a>
      <a href="links.html" class="flex items-center gap-2"><i class="fas fa-link"></i> Links</a>
      <a href="calender.html" class="flex items-center gap-2"><i class="fas fa-calendar-days"></i> Calendar</a>
      <a href="password.html" class="flex items-center gap-2"><i class="fas fa-lock"></i> Passwords</a>
    </div>

    <!-- Desktop User Info -->
    <div class="hidden md:flex items-center gap-4">
      <div class="text-right">
        <p id="userName" class="font-medium text-gray-800">User Name</p>
        <p id="userEmail" class="text-sm text-gray-600">user@example.com</p>
      </div>
      <img id="userPhoto" src="https://via.placeholder.com/40" class="w-10 h-10 rounded-full">
      <button onclick="logout()" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm">Logout</button>
    </div>

    <!-- Mobile Menu Button -->
    <button id="menu-btn" class="md:hidden text-gray-700 text-2xl"><i class="fas fa-bars"></i></button>
  </div>

  <!-- Mobile Links -->
  <div id="mobileMenu" class="hidden md:hidden flex flex-col px-4 pb-4 space-y-2 text-sm">
    <a href="home.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-100"><i class="fas fa-house"></i> Home</a>
    <a href="adress.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-100"><i class="fas fa-tasks"></i> Address</a>
    <a href="password.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-100"><i class="fas fa-key"></i> Passwords</a>
    <a href="income.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-100"><i class="fas fa-wallet"></i> Income</a>
    <a href="links.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-100"><i class="fas fa-link"></i> Links</a>
    <a href="calender.html" class="flex items-center gap-2 p-2 rounded hover:bg-gray-100"><i class="fas fa-calendar-alt"></i> Calendar</a>
    <div class="border-t border-gray-200 mt-2 pt-2">
      <p id="mobileUserName" class="font-medium text-gray-800">User Name</p>
      <p id="mobileUserEmail" class="text-xs text-gray-500">user@example.com</p>
      <button onclick="logout()" class="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600 mt-2 w-full">Logout</button>
    </div>
  </div>
</nav>

<!-- MAIN -->
<main class="pt-24 px-1 md:px-1 flex flex-col gap-2 max-w-6xl mx-auto ">

  <!-- Search & Download -->
<div class="flex flex-col md:flex-row justify-between items-center gap-1 md:gap-5 mb-10">
    <input type="text" id="searchInput" placeholder="Search tasks..."
      class="flex-1 p-3 rounded-full border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition text-sm"
      oninput="searchTasks()">
    <button id="downloadMonthTasks"
      class="mt-2 md:mt-0 px-4 py-2 bg-emerald-600 text-white rounded-lg shadow-md hover:bg-emerald-700 transition">Download
      Month Tasks</button>
  </div>
 <div id="searchResults" class="mt-1"></div>

<script>
  // Select button and mobile menu
const menuBtn = document.getElementById("menu-btn");
const mobileMenu = document.getElementById("mobileMenu");

// Toggle menu on click
menuBtn.addEventListener("click", () => {
  mobileMenu.classList.toggle("hidden"); // show/hide menu
});


</script>









  <!-- Calendar Navigation -->
  <div class="flex justify-between items-center mb-2">
    <button onclick="changeMonth(-1)" class="px-3 py-1 border rounded hover:bg-gray-100">← Prev</button>
    <h2 id="monthYear" class="text-lg font-semibold text-center flex-1">Month Year</h2>
    <button onclick="changeMonth(1)" class="px-3 py-1 border rounded hover:bg-gray-100">Next →</button>
  </div>

<!-- Calendar -->
<!-- Calendar -->
<div id="calendar" class="text-[20px]" style="width: 1300px;"></div>

</main>

<!-- Overlay -->
<div id="overlay" class="fixed inset-0 bg-black bg-opacity-40 hidden z-40 text-white text-2xl flex items-center justify-center">
</div>

<!-- Modal -->
<div id="taskModal" 
     class="fixed bg-white shadow-xl p-6 text-base rounded-xl w-11/12 md:w-3/4 max-w-6xl z-50 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 hidden h-[500px]">


  <!-- Modal Header -->
  <div class="flex justify-between items-center mb-4">
    <h2 id="modalDate" class="text-[22px] md:text-[20px] font-bold">Tasks for date</h2>
    <button id="closeModal" 
            class="text-gray-500 hover:text-red-500 text-[20px] md:text-[28px] font-bold transition duration-200">&times;</button>
  </div>

  <!-- Modal Body -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
    
    <!-- Add/Edit Task -->
    <div>
      <input id="taskTitle" type="text" placeholder="Title" 
             class="border border-gray-300 rounded-lg p-3 w-full mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-[18px]  ">
      <textarea id="taskDesc" placeholder="Description" 
                class="border border-gray-500 rounded-lg p-3 w-full mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-[18px] min-h-[250px] "></textarea>
      <div class="flex gap-3">
        <button id="saveTaskBtn" 
                class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-700 transition duration-200 font-bold text-[18px]">
          Save
        </button>
        <button id="cancelTaskBtn" 
                class="flex-1 bg-gray-400 text-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-500 transition duration-200 font-bold text-[18px]">
          Cancel
        </button>
      </div>
    </div>

    <!-- Existing Tasks -->
    <div id="existingTasks" class="border border-gray-300 rounded-lg p-4 bg-gray-50 max-h-[30rem] overflow-y-auto text-[25px]">
      <!-- Example saved task -->
      <div class="flex justify-between items-center p-5 mb-3 bg-white rounded-lg shadow hover:bg-blue-50 transition">
        <div>
          <strong class="text-[24px] md:text-[20px] font-bold">Task Title</strong>
          <p class="text-[20px] md:text-[20px] text-gray-800 leading-relaxed">Task description here</p>
        </div>
        <div class="flex gap-3">
          <button class="editBtn bg-yellow-400 text-white px-4 py-2 rounded shadow hover:bg-yellow-500 transition font-bold text-[18px]">
            Edit
          </button>
          <button class="deleteBtn bg-red-500 text-white px-4 py-2 rounded shadow hover:bg-red-600 transition font-bold text-[18px]">
            Delete
          </button>
        </div>
      </div>
    </div>

  </div>
</div>





 

</div>
<footer class="mt-12 pt-3 pb-3 bg-white text-gray-600 text-center text-sm border-t">
  &copy; 2025 Personal Website | All rights reserved
</footer>
<!-- Include your JS here -->
<script>
  /* Place your full JS code here exactly as provided */
</script>

</body>
</html>

 
</style>
<!-- Firebase compat libs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- jsPDF + AutoTable for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>


<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>



<script>
// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "AIzaSyB78RTVCg0cmSPp7A1RJyyAgBuCeolO0cc",
  authDomain: "sk12-58e9e.firebaseapp.com",
  databaseURL: "https://sk12-58e9e-default-rtdb.firebaseio.com",
  projectId: "sk12-58e9e",
  storageBucket: "sk12-58e9e.appspot.com",
  messagingSenderId: "608060704076",
  appId: "1:608060704076:web:c98e275ae1f449bc2a5e5f"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// --- Globals ---
let currentUser = null;
let currentDate = new Date();
let selectedDate = null;
let editTaskId = null;

// --- Helpers ---
const toISODate = d => new Date(d).toISOString().split("T")[0];
const formatDate = d => {
  const dt = new Date(d);
  return `${String(dt.getDate()).padStart(2,"0")}-${String(dt.getMonth()+1).padStart(2,"0")}-${dt.getFullYear()}`;
};
const formatPrettyDate = d => {
  const dt = new Date(d);
  return dt.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"});
};

// --- Auth ---
auth.onAuthStateChanged(user => {
  if(user){
    currentUser = user;
    document.getElementById("userName").textContent = user.displayName || "User";
    document.getElementById("userEmail").textContent = user.email;
    if(user.photoURL) document.getElementById("userPhoto").src = user.photoURL;
    document.getElementById("mobileUserName").textContent = user.displayName || "User";
    document.getElementById("mobileUserEmail").textContent = user.email;
    renderCalendar();
  } else {
    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
  }
});

function logout(){
  auth.signOut().then(()=>location.href="index.html");
}

// --- Calendar ---
function changeMonth(offset){
  currentDate.setMonth(currentDate.getMonth()+offset);
  renderCalendar();
}

function renderCalendar(){
  const cal=document.getElementById("calendar");
  cal.innerHTML="";
  const y=currentDate.getFullYear(), m=currentDate.getMonth();
  document.getElementById("monthYear").textContent=
    currentDate.toLocaleString("default",{month:"long",year:"numeric"});

  const firstDay=new Date(y,m,1), start=(firstDay.getDay()+6)%7;
  const days=new Date(y,m+1,0).getDate();

  for(let i=0;i<start;i++) cal.appendChild(document.createElement("div"));

  for(let d=1;d<=days;d++){
    const dateObj=new Date(y,m,d), iso=toISODate(dateObj);
    const cell=document.createElement("div");
    cell.className="calendar-cell text-center text-gray-800 p-4 rounded-lg hover:bg-blue-50 cursor-pointer transition text-[17px]";
    if(dateObj.toDateString()===new Date().toDateString()) cell.classList.add("today");
    if(dateObj.getDay()===0) cell.classList.add("sunday");

    // Date left, weekday right, no brackets
    cell.innerHTML=`
      <div class="flex justify-start items-center gap-2 font-semibold text-gray-800">
        <span class="text-xl">${d}</span>
        <span class="text-base text-gray-600">${dateObj.toLocaleString("en-US",{weekday:"short"})}</span>
      </div>
      <div id="tasks-${iso}" class="mt-2 text-sm text-left text-gray-700 min-h-[60px]"></div>
    `;
    cell.onclick=()=>openModal(iso);
    cal.appendChild(cell);
    loadTasks(iso);
  }
}

function openModal(dateISO) {
  // Function to format date +1 day as DD-MM-YYYY
  function formatDatePlusOne(dateISO) {
    const d = new Date(dateISO);
    d.setDate(d.getDate() + 1); // Add 1 day
    const day = String(d.getDate()).padStart(2, "0");
    const month = String(d.getMonth() + 1).padStart(2, "0"); // Months are 0-based
    const year = d.getFullYear();
    const weekday = d.toLocaleString("en-US", { weekday: "long" });
    return `${day}-${month}-${year} (${weekday})`;
  }

  // Set modal header
  document.getElementById("modalDate").textContent = `Tasks for ${formatDatePlusOne(dateISO)}`;

  // Reset inputs
  selectedDate = dateISO;
  editTaskId = null;
  document.getElementById("taskTitle").value = "";
  document.getElementById("taskDesc").value = "";

  // Show modal
  document.getElementById("overlay").classList.remove("hidden");
  document.getElementById("taskModal").classList.remove("hidden");

  // Load tasks
  loadModalTasks(dateISO);
}


function closeModal(){
  selectedDate=null; editTaskId=null;
  document.getElementById("overlay").classList.add("hidden");
  document.getElementById("taskModal").classList.add("hidden");
  document.getElementById("existingTasks").innerHTML="";
}
document.getElementById("closeModal").addEventListener("click",closeModal);
document.getElementById("cancelTaskBtn").addEventListener("click",closeModal);

// --- Save Task ---
document.getElementById("saveTaskBtn").addEventListener("click",()=>{
  const title=document.getElementById("taskTitle").value.trim();
  const desc=document.getElementById("taskDesc").value.trim();
  if(!title) return alert("Enter task title.");
  const ref=`users/${currentUser.uid}/tasks/${selectedDate}`;
  if(editTaskId){
    db.ref(`${ref}/${editTaskId}`).set({title,desc}).then(()=>{
      editTaskId=null;
      loadModalTasks(selectedDate);
      renderCalendar();
    });
  } else {
    db.ref(ref).push({title,desc}).then(()=>{
      loadModalTasks(selectedDate);
      renderCalendar();
    });
  }
  document.getElementById("taskTitle").value="";
  document.getElementById("taskDesc").value="";
});

// --- Load Tasks ---
function loadTasks(date){
  const c=document.getElementById(`tasks-${date}`); if(!c) return;
  db.ref(`users/${currentUser.uid}/tasks/${date}`).on("value",snap=>{
    const data=snap.val(); c.innerHTML="";
    if(data) Object.values(data).forEach(t=>{
      c.innerHTML+=`<div class="truncate">• ${t.title}</div>`;
    });
  });
}
function loadModalTasks(date){
  const cont = document.getElementById("existingTasks");
  cont.innerHTML = "Loading...";
  
  db.ref(`users/${currentUser.uid}/tasks/${date}`).once("value").then(snap => {
    const data = snap.val(); 
    cont.innerHTML = "";
    
    if(!data) return cont.textContent = "No tasks.";
    
    Object.entries(data).forEach(([id, t]) => {
      const div = document.createElement("div");
      div.className = "flex justify-between items-center p-4 mb-3 bg-white rounded-lg shadow hover:bg-blue-50 transition text-lg";
  div.innerHTML = `
  <div>
    <strong class="block text-gray-800">${t.title}</strong>
    <p class="text-gray-600 whitespace-pre-wrap break-words">${t.desc || ""}</p>
  </div>
`;

      
      const btns = document.createElement("div");
      btns.className = "flex gap-2";
      
      const e = document.createElement("button");
      e.innerHTML = `<i class="fas fa-edit"></i>`;
      e.className = "bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded-full shadow";
      e.onclick = () => {
        editTaskId = id;
        document.getElementById("taskTitle").value = t.title;
        document.getElementById("taskDesc").value = t.desc || "";
      };
      
      const dBtn = document.createElement("button");
      dBtn.innerHTML = `<i class="fas fa-trash"></i>`;
      dBtn.className = "bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-full shadow";
      dBtn.onclick = () => {
        if(confirm("Delete?")) {
          db.ref(`users/${currentUser.uid}/tasks/${date}/${id}`).remove().then(() => {
            loadModalTasks(date); 
            renderCalendar();
          });
        }
      };
      
      btns.appendChild(e);
      btns.appendChild(dBtn);
      div.appendChild(btns);
      cont.appendChild(div);
    });
  });
}

// --- PDF Download ---
document.getElementById("downloadMonthTasks").addEventListener("click",async()=>{
  const y=currentDate.getFullYear(), m=currentDate.getMonth();
  const snap=await db.ref(`users/${currentUser.uid}/tasks`).once("value");
  const data=snap.val()||{}, pdfData=[];
  for(let d=1;d<=new Date(y,m+1,0).getDate();d++){
    const iso=toISODate(new Date(y,m,d)), dateStr=formatDate(new Date(y,m,d));
    if(data[iso]) Object.values(data[iso]).forEach(t=>pdfData.push([dateStr,t.title,t.desc||""]));
  }
  if(!pdfData.length) return alert("No tasks this month.");
  const {jsPDF}=window.jspdf; const doc=new jsPDF();
  doc.setFontSize(18);
  doc.text(`Tasks for ${currentDate.toLocaleString("default",{month:"long",year:"numeric"})}`,14,20);
  doc.autoTable({startY:30,head:[["Date","Title","Description"]],body:pdfData});
  doc.save(`Tasks_${m+1}-${y}.pdf`);
});

let debounceTimeout;

function searchTasks() {
  clearTimeout(debounceTimeout);
  debounceTimeout = setTimeout(() => {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const resultsContainer = document.getElementById("searchResults");
    resultsContainer.innerHTML = "";

    if (!query) return;

    const user = firebase.auth().currentUser;
    if (!user) {
      resultsContainer.innerHTML = "<p style='padding: 10px;'>User not logged in.</p>";
      return;
    }

    const userId = user.uid;
    const userTasksRef = firebase.database().ref(`users/${userId}/tasks`);

    userTasksRef.once("value")
      .then(snapshot => {
        const allTasks = snapshot.val();
        if (!allTasks) {
          resultsContainer.innerHTML = "<p style='padding: 10px;'>No tasks found in your calendar.</p>";
          return;
        }

        let found = 0;
        const addedTasks = new Set();

      Object.entries(allTasks)
  // sort by date (latest first)
  .sort((a, b) => new Date(b[0]) - new Date(a[0]))
  .forEach(([date, tasks]) => {
    Object.entries(tasks).forEach(([id, task]) => {
      const titleMatch = task.title?.toLowerCase().includes(query);
      const descMatch = task.desc?.toLowerCase().includes(query);

      const normalize = str => (str || '').toLowerCase().trim();
      const uniqueKey = `${normalize(task.title)}-${normalize(task.desc)}-${date}`;

      if ((titleMatch || descMatch) && !addedTasks.has(uniqueKey)) {
        addedTasks.add(uniqueKey);
        found++;

        const currentDate = new Date(date);
        const nextDate = new Date(currentDate);
        nextDate.setDate(currentDate.getDate() + 1);

        const formattedNextDate = nextDate.toLocaleDateString('en-GB', {
          day: '2-digit', month: 'short', year: 'numeric'
        });
const taskDiv = document.createElement("div");
taskDiv.style.border = "1px solid #ddd";
taskDiv.style.borderRadius = "8px";
taskDiv.style.padding = "12px";
taskDiv.style.marginBottom = "12px";
taskDiv.style.background = "#e6f0ff";
taskDiv.style.boxShadow = "0 2px 6px rgba(0,0,0,0.05)";
taskDiv.style.cursor = "pointer"; 
taskDiv.style.transition = "background 0.2s ease";

// ✅ open modal when clicking the whole card
taskDiv.addEventListener("click", () => openModal(date));

// ✅ hover effect
taskDiv.addEventListener("mouseenter", () => {
  taskDiv.style.background = "#ffeb66"; // lighter yellow on hover
});
taskDiv.addEventListener("mouseleave", () => {
  taskDiv.style.background = "#e6f0ff"; // reset to original
});

taskDiv.innerHTML = `
  <div style="display: flex; justify-content: space-between; align-items: flex-start;">
    <strong style="font-size: 1.1em;">${task.title}</strong>
    <span style="color: #555; font-size: 17px;"><em>${formattedNextDate}</em></span>
  </div>
  <div style="margin-top: 6px;">${task.desc || 'No Description'}</div>
`;




        resultsContainer.appendChild(taskDiv);
      }
    });
  });


        if (found === 0) {
          resultsContainer.innerHTML = "<p style='padding: 10px;'>No matching tasks found.</p>";
        }
      })
      .catch(error => {
        console.error("Search error:", error);
        resultsContainer.innerHTML = "<p style='padding: 10px;'>Error retrieving tasks.</p>";
      });
  }, 300);
}

document.getElementById("downloadMonthTasks").addEventListener("click", async () => {
  if (!currentUser) return alert("User not logged in.");

  const year = currentDate.getFullYear();
  const month = currentDate.getMonth(); // 0-indexed
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  let allTasksText = `Tasks for ${currentDate.toLocaleString("default", { month: "long", year: "numeric" })}\n\n`;

  const userTasksRef = db.ref(`users/${currentUser.uid}/tasks`);
  const snapshot = await userTasksRef.once("value");
  const allTasks = snapshot.val() || {};

  let hasTasks = false;

  for (let day = 1; day <= daysInMonth; day++) {
    const dateObj = new Date(year, month, day);
    const dateStr = dateObj.toISOString().split("T")[0];

    if (allTasks[dateStr]) {
      hasTasks = true;
      Object.values(allTasks[dateStr]).forEach(task => {
        allTasksText += `Date: ${dateStr}\nTitle: ${task.title}\nType: ${task.type}\nDescription: ${task.desc}\n\n`;
      });
    }
  }

  if (!hasTasks) {
    allTasksText += "No tasks for this month.\n";
  }

  // Create blob and download
  const blob = new Blob([allTasksText], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `Tasks_${year}_${month + 1}.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
});




</script>



<style>

</style>









</body>
</html>










































































